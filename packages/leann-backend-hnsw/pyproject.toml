# packages/leann-backend-hnsw/pyproject.toml

[build-system]
requires = ["scikit-build-core>=0.10", "numpy", "swig"]
build-backend = "scikit_build_core.build"

[project]
name = "leann-backend-hnsw"
version = "0.1.8"
description = "Custom-built HNSW (Faiss) backend for the Leann toolkit."
dependencies = [
    "leann-core==0.1.8", 
    "numpy",
    "pyzmq>=23.0.0,<27",  # Cap at 26.x for manylinux2014 compatibility
    "msgpack>=1.0.0",
]

[tool.scikit-build]
wheel.exclude = ["CMakeLists.txt", "src", "third_party"]
sdist.include = ["CMakeLists.txt", "src", "third_party", "leann_backend_hnsw/*.txt"]
cmake.args = ["-DCMAKE_BUILD_TYPE=Release"]
# 确保 CMake 可以找到系统库
build-dir = "build/{cache_tag}"
minimum-version = "build-system.requires"

# CMake definitions to optimize compilation
[tool.scikit-build.cmake.define]
CMAKE_BUILD_PARALLEL_LEVEL = "8"
SKBUILD_SOABI = "YES"